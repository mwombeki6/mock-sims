# Mock SIMS - MUST Student Information Management System Simulator

A development/testing simulator for **Mbeya University of Science and Technology (MUST)** Student Information Management System. Provides OAuth 2.0 SSO and RESTful APIs for LMS integration testing.

## Features

âœ… **OAuth 2.0 Authorization Server** (Authorization Code Flow)
âœ… **Student Management APIs** (Profile, Courses, Grades, Timetable)
âœ… **Faculty Management APIs** (Teaching Assignments, CA Marks Submission)
âœ… **Course Management** (Catalog, Lectures, Enrollments)
âœ… **Real MUST Data Structure** (7 Colleges, 15+ Departments, 19 Bachelor Programs)
âœ… **Webhook Support** (HMAC-signed enrollment notifications to LMS)
âœ… **PostgreSQL Database** with GORM ORM
âœ… **Fiber Web Framework** (Fast HTTP routing)

---

## ðŸ“š API Documentation

**Beautiful modern API documentation with dark mode & orange accents:**

- **ðŸŽ¯ Main Documentation**: http://localhost:8000/docs
  - Modern dark UI with orange theme
  - Interactive endpoint explorer
  - Copy code examples with one click
  - Organized by resource type (OAuth, Students, Faculty, Courses, Admin)
  - Quick Start guide with test users

- **ðŸ“„ OpenAPI JSON**: http://localhost:8000/swagger.json
- **ðŸ”„ Legacy Routes**: `/swagger` and `/redoc` redirect to `/docs`

**Features:**
- âœ… Beautiful responsive dark mode design
- âœ… Orange color scheme matching MUST branding
- âœ… One-click code copying
- âœ… Expandable endpoint cards
- âœ… Tabbed navigation for easy browsing
- âœ… Complete request/response examples
- âœ… Parameter tables with types and descriptions

---

## Quick Start

### Prerequisites

- **Go 1.25+**
- **PostgreSQL (latest)**
- **Docker** (recommended for containerized setup)

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/mwombeki6/mock-sims.git
   cd mock-sims
   ```

2. **Install dependencies**
   ```bash
   go mod download
   ```

3. **Set up environment variables**
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

4. **Create PostgreSQL database**
   ```bash
   createdb mock_sims
   ```

5. **Run migrations / start the API** (auto-migrates on startup)
   ```bash
   # Local environment
   go run cmd/server/main.go

   # Docker users
   docker compose up --build
   ```

6. **Seed database** (recommended)
   ```bash
   # Local environment
   go run cmd/seed/main.go

   # Docker users
   docker compose run --rm mock-sims ./mock-sims-seed
   ```

---

## Configuration

Edit `.env` file:

```env
# Server
PORT=8000
HOST=0.0.0.0

# Database
DB_HOST=localhost
DB_PORT=5432
DB_USER=sims_user
DB_PASSWORD=sims_password
DB_NAME=mock_sims

# OAuth
OAUTH_CLIENT_ID=lms-client-id
OAUTH_CLIENT_SECRET=your-secret-here
OAUTH_REDIRECT_URI=http://localhost:8080/auth/callback

# LMS Webhook
LMS_WEBHOOK_URL=http://localhost:50051/webhooks/sims
LMS_WEBHOOK_SECRET=webhook-secret
```

---

## Seeded Dataset Highlights

Running the seeder now produces a SIMS snapshot that mirrors what students see in production:

- **7 colleges, 18 departments, 20+ programs** including Diploma in Computer Engineering.
- **Hundreds of students** spread across multi-year cohorts with unique reg numbers, admission history, and mixed enrollment/payment status.
- **Faculty roster** with realistic staff IDs and departmental assignments used when generating course timetables.
- **Course catalogue** with shared courses between programs plus autogenerated lecture schedules, venues, and assignments.
- **Historical data** â€“ previous semester grades, invoices, and receipts to exercise dashboards, transcripts, and payments workflows.

You can rerun `go run cmd/seed/main.go` any time; it is idempotent and will top up missing data without duplicating what already exists.

---

## API Endpoints

### OAuth 2.0

| Method | Endpoint            | Description                 |
|--------|---------------------|-----------------------------|
| GET    | `/oauth/authorize`  | Authorization page          |
| POST   | `/oauth/token`      | Exchange code for token     |

### Student APIs

| Method | Endpoint                       | Description                 |
|--------|--------------------------------|-----------------------------|
| GET    | `/api/students/me`             | Get authenticated student   |
| GET    | `/api/students/:id/courses`    | Get student's courses       |
| GET    | `/api/students/:id/grades`     | Get student's grades        |
| GET    | `/api/students/:id/timetable`  | Get student's timetable     |

### Faculty APIs

| Method | Endpoint                           | Description                    |
|--------|------------------------------------|--------------------------------|
| GET    | `/api/faculty/me`                  | Get authenticated faculty      |
| GET    | `/api/faculty/:id/courses`         | Get teaching assignments       |
| POST   | `/api/faculty/courses/:id/ca-marks`| Submit CA marks                |

### Course APIs

| Method | Endpoint                         | Description                 |
|--------|----------------------------------|-----------------------------|
| GET    | `/api/courses`                   | List all courses            |
| GET    | `/api/courses/:code`             | Get course details          |
| GET    | `/api/courses/:code/lectures`    | Get course schedule         |
| GET    | `/api/courses/:code/students`    | Get enrolled students       |

### Admin APIs

| Method | Endpoint               | Description                 |
|--------|------------------------|-----------------------------|
| GET    | `/api/colleges`        | List all colleges           |
| GET    | `/api/departments`     | List all departments        |
| GET    | `/api/programs`        | List all programs           |
| POST   | `/api/enrollments`     | Create bulk enrollments     |

---

## OAuth 2.0 Flow (SIMS SSO)

### Authorization Code Flow

```
1. LMS redirects to: http://localhost:8000/oauth/authorize?
   client_id=lms-client-id&redirect_uri=http://localhost:8080/auth/callback&response_type=code

2. Student enters SIMS credentials (reg_number + password)

3. SIMS redirects to: http://localhost:8080/auth/callback?code=AUTH_CODE_123

4. LMS exchanges code for token:
   POST /oauth/token
   {
     "grant_type": "authorization_code",
     "code": "AUTH_CODE_123",
     "client_id": "lms-client-id",
     "client_secret": "your-secret"
   }

5. Response:
   {
     "access_token": "eyJhbGci...",
     "token_type": "Bearer",
     "expires_in": 3600,
     "refresh_token": "eyJhbGci..."
   }
```

---

## Database Schema

### Colleges (7)
- College of Information and Communication Technology (CoICT)
- College of Engineering and Technology (CoET)
- College of Science and Technical Education (CoSTE)
- College of Agricultural Sciences and Technology (CoAST)
- College of Health Sciences and Technology (CoHST)
- College of Architecture and Construction Technology (CoACT)
- Centre for Innovation and Technology Transfer (CITT)

### Programs (19 Bachelor's + 13 Diplomas + 6 Masters + 3 PhDs)

See [CLAUDE.md](/CLAUDE.md) for complete list.

---

## Development

### Run in development mode
```bash
go run cmd/server/main.go
```

### Build binary
```bash
go build -o mock-sims cmd/server/main.go
./mock-sims
```

### Run tests
```bash
go test ./...
```

---

## Docker

### Build Docker image
```bash
docker build -t mock-sims:latest .
```

### Run with Docker Compose
```bash
docker-compose up -d
```

**Access Points:**
- API Server: http://localhost:8000
- Swagger UI: http://localhost:8000/swagger
- ReDoc: http://localhost:8000/redoc
- Health Check: http://localhost:8000/health

---

## Project Structure

```
mock-sims/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # Entry point
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/                  # Configuration
â”‚   â”œâ”€â”€ database/                # Database connection & migrations
â”‚   â”œâ”€â”€ models/                  # Database models (GORM)
â”‚   â”œâ”€â”€ handlers/                # HTTP handlers
â”‚   â”œâ”€â”€ middleware/              # Auth, logging, etc.
â”‚   â”œâ”€â”€ services/                # Business logic
â”‚   â””â”€â”€ utils/                   # Helpers (JWT, HMAC, etc.)
â”œâ”€â”€ migrations/                  # SQL migrations
â”œâ”€â”€ seeds/                       # Test data
â”œâ”€â”€ docs/                        # Documentation
â”œâ”€â”€ .env.example                 # Example environment variables
â”œâ”€â”€ go.mod                       # Go dependencies
â””â”€â”€ README.md                    # This file
```

---

## License

MIT License

---

## Contributing

Pull requests welcome! Please follow Go best practices.

---

## Contact

**Maintainer:** mwombeki6
**GitHub:** https://github.com/mwombeki6/mock-sims
**Issues:** https://github.com/mwombeki6/mock-sims/issues
